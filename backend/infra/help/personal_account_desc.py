---
### 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ü–µ–ª–∏–∫–æ–º

| –°–ª–æ–π                | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏                                                                     | –†–æ–ª—å                                                                                                                                         |
| ------------------- | ------------------------------------------------------------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------- |
| **Backend**         | **FastAPI** + **MongoDB (Motor async)** + AuthJWT (cookie-based JWT)           | –•–æ—Å—Ç–∏—Ç REST-API –¥–ª—è –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞ (–õ–ö) –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–Ω–µ–ª–∏.                                                                         |
| **–ê–¥–º–∏–Ω-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫** | –ö–∞—Å—Ç–æ–º–Ω—ã–π, –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ –±–∞–∑–æ–≤—ã—Ö –∫–ª–∞—Å—Å–∞—Ö `BaseCrudCore`, `BaseCrud`, `InlineCrud` | –ê–≤—Ç–æ-CRUD c –∏–Ω–ª–∞–π–Ω–∞–º–∏, –ø—Ä–∞–≤–∞–º–∏, –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π —Å—Ö–µ–º –¥–ª—è UI.                                                                                  |
| **–í–Ω–µ—à–Ω—è—è CRM**     | PaNa CRM, OAuth2 *client\_credentials*                                         | –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤, –≤–∏–∑–∏—Ç—ã, (–≤ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–µ) —Å–æ–≥–ª–∞—Å–∏—è, –±–æ–Ω—É—Å—ã, —Å–µ–º—å—é.                                                                   |
| **Frontend**        | SPA / PWA (–Ω–µ –æ–±—Å—É–∂–¥–∞–ª–æ—Å—å)                                                     | –†–µ–Ω–¥–µ—Ä–∏—Ç —Ñ–æ—Ä–º—ã –∏ —Å–ø–∏—Å–∫–∏, –æ–ø–∏—Ä–∞—è—Å—å **–∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ** –Ω–∞ JSON-–º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (`/info`), —Å —É—á—ë—Ç–æ–º `json_schema_extra["settings"]` —É Pydantic-–ø–æ–ª–µ–π. |
| **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**      | `CRMClient` + `CRMIntegrationMixin`                                            | –û–±—ë—Ä—Ç–∫–∞ –Ω–∞–¥ HTTP-API CRM: —Ç–æ–∫–µ–Ω—ã, –ø–æ–∏—Å–∫/—Å–æ–∑–¥–∞–Ω–∏–µ –ø–∞—Ü–∏–µ–Ω—Ç–∞, –ø–∞—Ç—á–∏, –≤–∏–∑–∏—Ç—ã.                                                                    |

---

### 2. –ë–∞–∑–æ–≤—ã–π CRUD-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫

| –ö–ª–∞—Å—Å              | –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                                                                                                                                                                                                                                                                                                                                                                               |
| ------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **`BaseCrudCore`** | - –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã `list / list_with_meta / get / create / update / delete`.<br>- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ (`permission_class`) –∏ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π (`allow_crud_actions`).<br>- **–ò–Ω–ª–∞–π–Ω—ã** (`process_inlines`, `get_inlines`).<br>- –°–ª–æ–∂–Ω–∞—è —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è, —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è Enum/Files –∏ –∞–≤—Ç–æ–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤—ã—á–∏—Å–ª—è–µ–º—ã—Ö –ø–æ–ª–µ–π.<br>- –ü–æ–º–æ—â–Ω–∏–∫–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (`nested_find`, `get_root_document` ‚Ä¶). |
| **`InlineCrud`**   | CRUD –ø–æ–≤–µ—Ä—Ö ***–≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –º–∞—Å—Å–∏–≤–æ–≤/–æ–±—ä–µ–∫—Ç–æ–≤*** –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ-—Ä–æ–¥–∏—Ç–µ–ª–µ. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç `dot_field_path`, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π `$push/$unset/$pull`, –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é.                                                                                                                                                                                                                                                      |
| **`BaseCrud`**     | CRUD –ø–æ —Ä–µ–∞–ª—å–Ω—ã–º –∫–æ–ª–ª–µ–∫—Ü–∏—è–º Mongo. –†–∞—Å—à–∏—Ä—è–µ—Ç `get_queryset` –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π.                                                                                                                                                                                                                                                                                                                                            |

> üîë –í—Å–µ –º–æ–¥–µ–ª–∏-–Ω–∞—Å–ª–µ–¥–Ω–∏–∫–∏ –æ–±—ä—è–≤–ª—è—é—Ç: `model = PydanticSchema`, `collection_name`, —Å–ø–∏—Å–∫–∏ –ø–æ–ª–µ–π (`list_display`, `detail_fields`, `computed_fields`, `read_only_fields`), –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—É—é –∫–∞—Ä—Ç—É `inlines = {"contacts": ContactInlineCrud}` –∏ —Ç.–¥.

---

### 3. –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∞—Ä—à—Ä—É—Ç–æ–≤ –∏ UI-–º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö

1. **`auto_discover_modules("admin")`** ‚Äî —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ `admin.py`, –≥–¥–µ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è CRUD-–∫–ª–∞—Å—Å—ã –≤ –æ–±—ä–µ–∫—Ç-`registry`.
2. **`generate_base_routes(registry)`**:

   * –°–æ–∑–¥–∞—ë—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ `/login / refresh / logout` —Å JWT-–∫—É–∫–∞–º–∏ –∏ ¬´—á—ë—Ä–Ω—ã–º —Å–ø–∏—Å–∫–æ–º¬ª JTI.
   * –î–ª—è ***–∫–∞–∂–¥–æ–π*** –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Å—Ç—Ä–æ–∏—Ç REST-–º–∞—Ä—à—Ä—É—Ç—ã –≤ —Ñ–æ—Ä–º–µ
     `/{entity}/`, `/{entity}/{id}` –¥–ª—è **GET / POST / PATCH / DELETE** –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç `allow_crud_actions`.
   * –ö–æ–Ω—Ü–µ–≤–∏–∫ **`/info`** –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–µ—Ä–∞—Ä—Ö–∏—é ¬´–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ‚Üí –ú–æ–¥–µ–ª—å ‚Üí –ü–æ–ª—è ‚Üí –ò–Ω–ª–∞–π–Ω—ã ‚Üí –ú–∞—Ä—à—Ä—É—Ç—ã¬ª ‚Äî –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ñ—É–Ω–∫—Ü–∏–π:

     * `build_model_info()` ‚Üí `build_field_schema()` (+ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–µ–¥—É–∫—Ü–∏—è UI-—Ç–∏–ø–∞: –∫–∞–ª–µ–Ω–¥–∞—Ä—å, select, image ‚Ä¶).
     * `build_inlines()`, `build_field_groups()`.
     * –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ö–µ–ª–ø–µ—Ä—ã `map_python_type_to_ui`, `determine_field_type_and_choices`, Enum-choice factories –∏ –¥—Ä.

–§—Ä–æ–Ω—Ç —á–∏—Ç–∞–µ—Ç `/info` –∏ **–±–µ–∑ —Ä—É—á–Ω–æ–≥–æ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è** –∑–Ω–∞–µ—Ç:

* –∫–∞–∫ –æ—Ç—Ä–∏—Å–æ–≤–∞—Ç—å —Ñ–æ—Ä–º—ã (placeholder, mask, rows, color\_map, readonly, required‚Ä¶),
* –∫–∞–∫–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–µ—Ä–≥–∞—Ç—å CRUD‚Äô–æ–º,
* –∫–∞–∫–∏–µ –ø–æ–ª—è –ø–æ–∫–∞–∑–∞—Ç—å –≤ —Ç–∞–±–ª–∏—Ü–µ-–ª–∏—Å—Ç–µ.

---

### 4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å PaNa CRM

```mermaid
sequenceDiagram
    participant Portal as Patient-Portal
    participant CRM as PaNa CRM
    activate Portal
    Portal->>CRM: POST /oauth/token (client_credentials)
    CRM-->>Portal: {access_token, expires_in}
    deactivate CRM
```

| –û–±—ä–µ–∫—Ç                    | –ú–µ—Ç–æ–¥—ã                                                                                                                                                                                                                                                                                  |
| ------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **`CRMClient`**           | ‚Ä¢ `refresh_token()` / `get_token()` ‚Äî —Ö—Ä–∞–Ω–∏—Ç + –æ–±–Ω–æ–≤–ª—è–µ—Ç OAuth token (60 s early).<br>‚Ä¢ `call(method, path, params?, json?)` ‚Äî –æ–±—â–∞—è –æ–±—ë—Ä—Ç–∫–∞, –∫–∏–¥–∞–µ—Ç `CRMError(502)` –ø—Ä–∏ 4xx+.<br>‚Ä¢ `find_patient`, `create_patient`, `patch_patient`, `future_appointments`, `find_or_create_patient`. |
| **`CRMIntegrationMixin`** | ‚Ä¢ `sync_create_with_crm()` ‚Äî —Å–æ–∑–¥–∞—Ç—å/–Ω–∞–π—Ç–∏ –ø–∞—Ü–∏–µ–Ω—Ç–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏, –≤–Ω–æ—Å–∏—Ç `patient_id`, —Å—Ç–∞–≤–∏—Ç `account_status=UNVERIFIED`.<br>‚Ä¢ `patch_contacts_in_crm()` ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω—ã–π PATCH (–æ—à–∏–±–∫–∏ –≥–ª—É—à–∞—Ç—Å—è).<br>‚Ä¢ `calc_account_status()` ‚Äî –≤–∏–∑–∏—Ç —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `closed` ‚Üí `VERIFIED`.              |

üîÑ **OpenAPI v1.0** vs —Å—Ç–∞—Ä—ã–π –ø—É—Ç—å `/registration`:

| –î–µ–π—Å—Ç–≤–∏–µ                               | –ù–æ–≤—ã–π –ø—É—Ç—å                             | –í –∫–æ–¥–µ —Å–µ–π—á–∞—Å                          |
| -------------------------------------- | -------------------------------------- | -------------------------------------- |
| –ü–æ–∏—Å–∫ –ø–∞—Ü–∏–µ–Ω—Ç–∞                         | `GET /patients/search?phone&pesel`     | `POST /registration {action:"search"}` |
| –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞—Ü–∏–µ–Ω—Ç–∞                      | `POST /patients`                       | `POST /registration`                   |
| PATCH –ø–∞—Ü–∏–µ–Ω—Ç–∞                         | `PATCH /patients/{id}`                 | ‚úîÔ∏è                                     |
| –í–∏–∑–∏—Ç—ã                                 | `GET /patients/{id}/appointments`      | ‚úîÔ∏è                                     |
| Consents, Bonus, Family, Questionnaire | –í —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏; –≤ –∫–æ–¥–µ **–æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç** |                                        |

---

### 5. Pydantic-—Å—Ö–µ–º—ã –õ–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞ (front-facing)

| –ì—Ä—É–ø–ø–∞                 | –°—Ö–µ–º—ã & –ø–æ–ª—è                                                                                                                                                                                  | UI-–º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (—á–µ—Ä–µ–∑ `Field(..., json_schema_extra={"settings": ‚Ä¶})`) |
| ---------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------- |
| **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è / –≤—Ö–æ–¥** | `RegistrationSchema` (—Ç–µ–ª–µ—Ñ–æ–Ω, email, –ø–∞—Ä–æ–ª—å+confirm, accept\_terms), `ConfirmationSchema` (+code), `LoginSchema`, `TwoFASchema`.                                                             | –ü–∞—Ä–æ–ª–∏ —Å–≤–µ—Ä—è—é—Ç—Å—è –º–µ—Ç–æ–¥–∞–º–∏ `passwords_match()`, `check_password()`.    |
| **–ü–∞—Ü–∏–µ–Ω—Ç**            | `MainInfoSchema` ‚Äî –§–ò–û, –¥–∞—Ç–∞ —Ä–æ–∂–¥. (calendar), –ø–æ–ª (select), –∞–≤–∞—Ç–∞—Ä, `account_status` (readonly), `metadata` (readonly).                                                                      | –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω—ã–µ placeholder‚Äô—ã.                                          |
| **–ö–æ–Ω—Ç–∞–∫—Ç—ã**           | `ContactInfoSchema` ‚Äî email (type=email), phone (mask), address (textarea), pesel (custom), emergency\_contact (allowExtraText).                                                              |                                                                       |
| **–ê–Ω–∫–µ—Ç–∞ –∑–¥–æ—Ä–æ–≤—å—è**    | `HealthSurveySchema` ‚Äî allergies (tag\_cloud), chronic\_conditions (enum multiselect —Å —Ü–≤–µ—Ç–∞–º–∏), smoking\_status (select —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ `value`/`label` dict), current\_medications (textarea). |                                                                       |
| **–°–µ–º—å—è**              | `FamilyMemberSchema` ‚Äî phone, relationship (select), status (select), birth\_date (calendar), member\_name/id, bonus\_balance (`hide_if_none`).                                               |                                                                       |
| **–ë–æ–Ω—É—Å—ã**             | `BonusProgramSchema` ‚Äî balance (readonly int), referral\_code, `transaction_history: List[BonusTransactionSchema]` (amount, type, title, description).                                        |                                                                       |
| **–°–æ–≥–ª–∞—Å–∏—è**           | `ConsentSchema(consents: List[ConsentEnum])` (—Ü–≤–µ—Ç–æ–≤–∞—è –∫–∞—Ä—Ç–∞ yes/no).                                                                                                                         |                                                                       |
| **–í–∏–∑–∏—Ç—ã**             | `AppointmentSchema` (visit\_date, start, end, doctor\_name, status) ‚Äî **—Ç–æ–ª—å–∫–æ read-only**.                                                                                                   |                                                                       |

> –≠—Ç–∏ —Å—Ö–µ–º—ã –∂–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–∞–∫ `model` —É CRUD-–∫–ª–∞—Å—Å–æ–≤, —Ç–∞–∫ —á—Ç–æ –∏ –∞–¥–º–∏–Ω–∫–∞, –∏ –õ–ö –¥–µ–ª—è—Ç –æ–¥–∏–Ω –∫–æ–Ω—Ç—Ä–∞–∫—Ç.

---

### 6. –ê–∫–∫–∞—É–Ω—Ç-—Ä–æ—É—Ç—ã –õ–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞

1. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è**

   * `/register` ‚Äî –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥ ‚Üí `REG_CODES[phone]`.
   * `/register_confirm` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞, —Å–æ–∑–¥–∞–Ω–∏–µ `User` + –¥–≤—É—Ö –∫–æ–ª–ª–µ–∫—Ü–∏–π –ø–∞—Ü–∏–µ–Ω—Ç–∞ (`patients_main_info`, `patients_contact_info`), —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ `metadata` –∏–∑ `request.query_params`, **(CRM –≤—ã–∑–æ–≤ –ø–æ–∫–∞ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω)**, –≤—ã–¥–∞—á–∞ access+refresh cookies.
2. **–í—Ö–æ–¥**

   * `/login` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è, –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ `patient_id` ‚Üí (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π) –ø–æ–∏—Å–∫ –≤ CRM, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è 2FA-–∫–æ–¥–∞ ‚Üí `TWO_FA_CODES[phone]`.
   * `/login_confirm` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞, –≤—ã–¥–∞—á–∞ —Ç–æ–∫–µ–Ω–æ–≤.
3. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è + CRUD-–º–∞—Ä—à—Ä—É—Ç—ã** ‚Äî –≤ –∫–æ–Ω—Ü–µ `router.include_router(generate_base_routes(registry))`, —Ç–∞–∫ —á—Ç–æ –≤–µ—Å—å CRUD –Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è.

‚ö†Ô∏è `REG_CODES` –∏ `TWO_FA_CODES` ‚Äî –ø–æ–∫–∞ **in-memory** dict. –î–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω–∞ –ª—É—á—à–µ Redis TTL.

---

### 7. üîÆ –ß—Ç–æ –µ—â—ë –Ω–µ —Å–¥–µ–ª–∞–Ω–æ / –∑–æ–Ω–¥—ã —Ä–æ—Å—Ç–∞

* –ü–µ—Ä–µ–≤–µ—Å—Ç–∏ —Å—Ç–∞—Ä—ã–π `/registration` API –Ω–∞ –Ω–æ–≤—ã–π `/patients` + `/patients/search` (–∏–ª–∏ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ legacy –æ—Å—Ç–∞—ë—Ç—Å—è).
* –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å CRM endpoints: **Consents, Bonus, Family, Questionnaire** –∏ –¥–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã –≤ `CRMClient`.
* –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –∫–æ–¥—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏/2FA –≤ Redis —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º —á–∞—Å—Ç–æ—Ç—ã.
* –û—Ñ–æ—Ä–º–∏—Ç—å –≤–Ω–µ—à–Ω–∏–π –ø–∞–∫–µ—Ç/–º–æ–¥—É–ª—å `accounts`, –≤—ã–Ω–µ—Å—Ç–∏ –ª–æ–≥–∏–∫—É –≤—ã–¥–∞—á–∏ —Ç–æ–∫–µ–Ω–æ–≤ –∏ —á—ë—Ä–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞.
* –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `account_status` –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤–∏–∑–∏—Ç–∞.
* –†–∞—Å—à–∏—Ä–∏—Ç—å —Ñ—Ä–æ–Ω—Ç: –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ –∏–Ω–ª–∞–π–Ω–æ–≤-—Å–ø–∏—Å–∫–æ–≤ (—Å–µ–º—å—è, –±–æ–Ω—É—Å-—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏) –∏ readonly-—Ç–∞–±–ª–∏—Ü (appointments).

---

### 8. –ë—ã—Å—Ç—Ä—ã–µ —Å—Å—ã–ª–∫–∏ –≤ –∫–æ–¥–µ (–Ω–∞–∑–≤–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π / –∫–ª–∞—Å—Å–æ–≤)

```
# crud_base.py
class BaseCrudCore ...
class InlineCrud ...
class BaseCrud ...

# crm.py
class CRMClient ...
class CRMIntegrationMixin ...
def get_client() -> CRMClient

# schemas.py
RegistrationSchema, ConfirmationSchema, LoginSchema, TwoFASchema
MainInfoSchema, ContactInfoSchema, HealthSurveySchema
FamilyMemberSchema, BonusProgramSchema, BonusTransactionSchema
ConsentSchema, AppointmentSchema

# routes_admin.py
generate_base_routes(registry)
build_model_info(), build_field_schema(), build_inlines(), ...

# routes_account.py
generate_base_account_routes(registry)
```

---

### 9. TL;DR

* **–ì–ª–∞–≤–Ω–∞—è –∏–¥–µ—è**: –µ–¥–∏–Ω–∞—è –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–∞—è –º–æ–¥–µ–ª—å (`Pydantic Schema + Crud Class`) ‚Üí –∏–∑ –Ω–µ—ë –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞–µ—Ç—Å—è REST-API, —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∏ *–ø–æ–ª–Ω–∞—è* UI-—Å—Ö–µ–º–∞ –¥–ª—è —Ñ—Ä–æ–Ω—Ç–∞.
* **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è CRM**: –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç —Å –∞–≤—Ç–æ—Ç–æ–∫–µ–Ω–æ–º, –ø–æ–∫–∞ –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–∏—Å–∫/—Å–æ–∑–¥–∞–Ω–∏–µ/–∞–ø–¥–µ–π—Ç—ã –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ –∏ –≤–∏–∑–∏—Ç—ã; –¥—Ä—É–≥–∏–µ —Ä–µ—Å—É—Ä—Å—ã pending.
* **–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç**: –¥–≤—É—Ö—à–∞–≥–æ–≤–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –≤—Ö–æ–¥ —Å SMS/2FA, —Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ –≤ –¥–≤—É—Ö Mongo-–∫–æ–ª–ª–µ–∫—Ü–∏—è—Ö (`main_info`, `contact_info`), –∫—É–∫–∏-JWT, –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–≤—è–∑–∞—Ç—å—Å—è —Å CRM.
* **–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏**: –¥–æ–ø–∏–ª–∏—Ç—å –≤—Å–µ –Ω–æ–≤—ã–µ —ç–Ω–¥–ø–æ–π–Ω—Ç—ã CRM + –≤—ã–Ω–µ—Å—Ç–∏ –∫–æ–¥—ã –≤ Redis + —É—Å–∏–ª–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é/–ª–∏–º–∏—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ + –¥–æ–±–∞–≤–∏—Ç—å —Å–æ–≥–ª–∞—Å–∏—è/–±–æ–Ω—É—Å—ã/—Å–µ–º—å—é –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ.
