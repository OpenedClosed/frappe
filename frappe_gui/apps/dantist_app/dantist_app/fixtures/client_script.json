[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Bot Settings",
  "enabled": 1,
  "modified": "2025-10-24 00:30:25.754004",
  "module": null,
  "name": "Bot Settings Help",
  "script": "frappe.ui.form.on(\"Bot Settings\", {\n  refresh(frm) {\n    // ---------- helpers ----------\n    const field = frm.fields_dict[\"help_panel\"];\n    if (!field || !field.$wrapper) return;\n\n    function readCookie(name){\n      const m = document.cookie.match(new RegExp(\"(?:^|;\\\\s*)\"+name+\"=([^;]+)\"));\n      return m ? decodeURIComponent(m[1]) : \"\";\n    }\n    function safe(obj, path, dflt=\"\"){ try { return path.split(\".\").reduce((o,k)=>o?.[k], obj) ?? dflt; } catch { return dflt; } }\n    function pickLang(){\n      const boot = frappe.boot || {};\n      const user = (boot.user || {});\n      const udefs = user.defaults || user.user_defaults || {};\n      const cands = [\n        user.language, user.user_language, udefs.language, udefs.lang,\n        readCookie(\"preferred_language\"), readCookie(\"lang\"),\n        boot.lang, safe(boot,\"sysdefaults.language\",\"\"),\n        (navigator.languages && navigator.languages[0]) || navigator.language || \"\"\n      ].filter(Boolean);\n      const map = s => {\n        const v = String(s||\"\").toLowerCase();\n        if (v.startsWith(\"ru\")) return \"ru\";\n        if (v.startsWith(\"uk\") || v.startsWith(\"ua\")) return \"uk\";\n        if (v.startsWith(\"pl\")) return \"pl\";\n        if (v.startsWith(\"ka\") || v.includes(\"geor\")) return \"ka\";\n        if (v.startsWith(\"be\")) return \"be\";\n        return \"en\";\n      };\n      for (const c of cands){ const m = map(c); if (m) return m; }\n      return \"en\";\n    }\n\n    // словари (как у тебя)\n    const M = {\n      en:{title:\"💡 Quick guide to Bot Settings\",items:[\n        \"<strong>Project Name</strong> — internal name for lists and search.\",\n        \"<strong>Employee Name</strong> — the public display name in chat.\",\n        \"<strong>Avatar</strong> &amp; <strong>Bot Color</strong> — visual look of the widget.\",\n        \"<strong>Communication Tone</strong> &amp; <strong>Personality Traits</strong> — how the bot speaks.\",\n        \"<strong>Core Principles</strong> — always-on guardrails and boundaries.\",\n        \"<strong>Additional Instructions</strong> — step-by-step behavior for preparing, answering, finishing.\",\n        \"<strong>Special Instructions</strong> — quick presets (e.g., be concise, don’t invent info).\",\n        \"<strong>Forbidden Topics</strong> — subjects the bot must avoid.\",\n        \"<strong>Target Actions</strong> — what the bot helps with (can be multiple).\"\n      ],msgTitle:\"Messages (JSON)\",msgText:\"use a simple language→text map. Example:\",tip1:'Use standard language codes (e.g., <code>en</code>) and only those you actually need.',tip2:\"The most recently created bot is prioritized and shown first by default.\",json:'{\\n  \"en\": \"Hello! How can I help you?\"\\n}'},\n      ru:{title:\"💡 Краткое руководство по настройкам бота\",items:[\n        \"<strong>Название проекта</strong> — внутреннее имя для списков и поиска.\",\n        \"<strong>Имя сотрудника</strong> — публичное отображаемое имя в чате.\",\n        \"<strong>Аватар</strong> и <strong>Цвет бота</strong> — визуальный вид виджета.\",\n        \"<strong>Тон общения</strong> и <strong>Черты личности</strong> — как бот говорит.\",\n        \"<strong>Базовые принципы</strong> — постоянные рамки и ограничения.\",\n        \"<strong>Дополнительные инструкции</strong> — пошаговое поведение: подготовка, ответ, завершение.\",\n        \"<strong>Особые инструкции</strong> — быстрые пресеты (например, быть кратким, не выдумывать факты).\",\n        \"<strong>Запрещённые темы</strong> — темы, которых боту следует избегать.\",\n        \"<strong>Целевые действия</strong> — с чем бот помогает (можно несколько).\"\n      ],msgTitle:\"Сообщения (JSON)\",msgText:\"используют простую карту язык→текст. Пример:\",tip1:'Используйте стандартные коды языков (например, <code>en</code>) и только те, что действительно нужны.',tip2:\"Самый недавно созданный бот приоритизируется и показывается первым по умолчанию.\",json:'{\\n  \"ru\": \"Здравствуйте! Чем могу помочь?\"\\n}'},\n      uk:{title:\"💡 Короткий гайд з налаштувань бота\",items:[\n        \"<strong>Назва проєкту</strong> — внутрішня назва для списків і пошуку.\",\n        \"<strong>Ім’я співробітника</strong> — публічне ім’я в чаті.\",\n        \"<strong>Аватар</strong> і <strong>Колір бота</strong> — візуальний вигляд віджета.\",\n        \"<strong>Тон спілкування</strong> і <strong>Риси особистості</strong> — як говорить бот.\",\n        \"<strong>Базові принципи</strong> — постійні правила та межі.\",\n        \"<strong>Додаткові інструкції</strong> — покрокова поведінка: підготовка, відповідь, завершення.\",\n        \"<strong>Особливі інструкції</strong> — швидкі пресети (напр., бути лаконічним, не вигадувати факти).\",\n        \"<strong>Заборонені теми</strong> — теми, яких слід уникати.\",\n        \"<strong>Цільові дії</strong> — з чим допомагає бот (може бути декілька).\"\n      ],msgTitle:\"Повідомлення (JSON)\",msgText:\"використовують просту мапу мова→текст. Приклад:\",tip1:'Використовуйте стандартні коди мов (наприклад, <code>en</code>) лише за потреби.',tip2:\"Найсвіжіше створений бот пріоритезується і показується першим за замовчуванням.\",json:'{\\n  \"uk\": \"Вітаю! Чим я можу допомогти?\"\\n}'},\n      pl:{title:\"💡 Krótki przewodnik po ustawieniach bota\",items:[\n        \"<strong>Nazwa projektu</strong> — wewnętrzna nazwa do list i wyszukiwania.\",\n        \"<strong>Imię pracownika</strong> — publiczna nazwa wyświetlana na czacie.\",\n        \"<strong>Avatar</strong> i <strong>Kolor bota</strong> — wygląd widżetu.\",\n        \"<strong>Ton komunikacji</strong> i <strong>Cechy osobowości</strong> — jak mówi bot.\",\n        \"<strong>Główne zasady</strong> — stałe ograniczenia i reguły.\",\n        \"<strong>Dodatkowe instrukcje</strong> — krok po kroku: przygotowanie, odpowiedź, zakończenie.\",\n        \"<strong>Instrukcje specjalne</strong> — szybkie presety (np. bądź zwięzły, nie wymyślaj faktów).\",\n        \"<strong>Tematy zabronione</strong> — tematy, których bot ma unikać.\",\n        \"<strong>Akcje docelowe</strong> — w czym bot pomaga (może być wiele).\"\n      ],msgTitle:\"Wiadomości (JSON)\",msgText:\"używają prostej mapy język→tekst. Przykład:\",tip1:'Używaj standardowych kodów języków (np. <code>en</code>) tylko gdy potrzebne.',tip2:\"Najświeżej utworzony bot ma priorytet i domyślnie wyświetla się pierwszy.\",json:'{\\n  \"pl\": \"Cześć! W czym mogę pomóc?\"\\n}'},\n      ka:{title:\"💡 მოკლე გზამკვლევი ბოტის პარამეტრებისთვის\",items:[\n        \"<strong>პროექტის სახელი</strong> — შიდა სახელწოდება სიებისა და ძიებისთვის.\",\n        \"<strong>თანამშრომლის სახელი</strong> — საჯარო სახელი ჩატში.\",\n        \"<strong>ავატარი</strong> და <strong>ბოტის ფერი</strong> — ვიჯეტის იერი.\",\n        \"<strong>კომუნიკაციის ტონი</strong> და <strong>პიროვნული თვისებები</strong> — როგორ საუბრობს ბოტი.\",\n        \"<strong>ძირითადი პრინციპები</strong> — მუდმივი წესები და საზღვრები.\",\n        \"<strong>დამატებითი ინსტრუქციები</strong> — ნაბიჯ-ნაბიჯ: მომზადება, პასუხი, დასრულება.\",\n        \"<strong>სპეციალური ინსტრუქციები</strong> — სწრაფი პრესეტები (მაგ., იყავი მოკლე, არ მოიგონო ფაქტები).\",\n        \"<strong>აკრძალული თემები</strong> — თემები, რომლებსაც ბოტი უნდა ერიდოს.\",\n        \"<strong>სამიზნე ქმედებები</strong> — რაში ეხმარება ბოტი (შეიძლება რამდენიმე).\"\n      ],msgTitle:\"შეტყობინებები (JSON)\",msgText:\"გამოიყენეთ მარტივი მാപ്പა ენა→ტექსტი. მაგალითი:\",tip1:'გამოიყენეთ სტანდარტული ენის კოდები (მაგ. <code>en</code>) მხოლოდ საჭიროების შემთხვევაში.',tip2:\"უახლესად შექმნილი ბოტი პრიორიტეტულია და ნაგულისხმევად პირველი ჩანს.\",json:'{\\n  \"ka\": \"გამარჯობა! რით შემიძლია დაგეხმაროთ?\"\\n}'},\n      be:{title:\"💡 Кароткі гайд па наладах бота\",items:[\n        \"<strong>Назва праекта</strong> — унутраная назва для спісаў і пошуку.\",\n        \"<strong>Імя супрацоўніка</strong> — публічнае імя ў чаце.\",\n        \"<strong>Аватар</strong> і <strong>Колер бота</strong> — выгляд віджэта.\",\n        \"<strong>Тон зносін</strong> і <strong>Рысы асобы</strong> — як гаворыць бот.\",\n        \"<strong>Базавыя прынцыпы</strong> — пастаянныя межы і правілы.\",\n        \"<strong>Дадатковыя інструкцыі</strong> — пакрокавае паводзіны: падрыхтоўка, адказ, завяршэнне.\",\n        \"<strong>Асаблівыя інструкцыі</strong> — хуткія прэсеты (напрыклад, быць кароткім, не прыдумляць факты).\",\n        \"<strong>Забароненыя тэмы</strong> — тэмы, якіх трэба пазбягаць.\",\n        \"<strong>Мэтныя дзеянні</strong> — чаму дапамагае бот (можа быць некалькі).\"\n      ],msgTitle:\"Паведамленні (JSON)\",msgText:\"выкарыстоўваюць простую мапу мова→тэкст. Прыклад:\",tip1:'Выкарыстоўвайце стандартныя коды моў (напрыклад, <code>en</code>) толькі пры патрэбе.',tip2:\"Найбольш нядаўна створаны бот мае прыярытэт і паказваецца першым па змоўчанні.\",json:'{\\n  \"be\": \"Вітаю! Чым магу дапамагчы?\"\\n}'}\n    };\n\n    const lang = pickLang();\n    const T = M[lang] || M.en;\n\n    // читаем актуальные значения CSS-переменных темы\n    function cssVar(name, fallback){ \n      const v = getComputedStyle(document.documentElement).getPropertyValue(name).trim();\n      return v || fallback;\n    }\n    function palette(){\n      return {\n        cardBg:   cssVar(\"--card-bg\", \"#ffffff\"),\n        controlBg:cssVar(\"--control-bg\", \"#f9fafb\"),\n        border:   cssVar(\"--border-color\", \"#e5e7eb\"),\n        text:     cssVar(\"--text-color\", \"#111827\"),\n      };\n    }\n\n    // рендер блока (инлайновые стили — как у тебя, только цвета из темы)\n    function render() {\n      const p = palette();\n      const $root = (() => {\n        let r = field.$wrapper.find(\".bot-help\");\n        if (!r.length) {\n          field.$wrapper.empty().append($('<div class=\"bot-help\"></div>'));\n          r = field.$wrapper.find(\".bot-help\");\n        }\n        return r;\n      })();\n\n      const ul = T.items.map(li => `<li>${li}</li>`).join(\"\");\n      const html =\n        `<div class=\"bot-help\" style=\"margin:8px 0 0; padding:12px 14px; border:1px solid ${p.border}; border-radius:8px; background:${p.controlBg}; color:${p.text};\" lang=\"${lang}\" dir=\"ltr\">` +\n          `<div style=\"font-weight:600; margin:0 0 8px;\">${T.title}</div>` +\n          `<ul style=\"margin:0 0 10px 18px; padding:0; line-height:1.6;\">${ul}</ul>` +\n          `<p style=\"margin:0 0 6px; line-height:1.6;\"><strong>${T.msgTitle}</strong> ${T.msgText}</p>` +\n          `<pre style=\"margin:0 0 10px; background:${p.cardBg}; border:1px solid ${p.border}; border-radius:6px; padding:10px; overflow:auto; color:${p.text};\">{\\n  \"${lang}\": \"${lang==='ru'?'Здравствуйте! Чем могу помочь?':'Hello! How can I help you?'}\"\\n}</pre>` +\n          `<ul style=\"margin:0; padding:0 0 0 18px; line-height:1.6;\">` +\n            `<li> ${T.tip1}</li>` +\n            `<li> ${T.tip2}</li>` +\n          `</ul>` +\n        `</div>`;\n\n      field.$wrapper.html(html);\n    }\n\n    render();\n\n    // при смене темы — перечитать CSS vars и перерендерить блок\n    try {\n      const mo = new MutationObserver(() => render());\n      mo.observe(document.documentElement, { attributes: true, attributeFilter: [\"data-theme\"] });\n      // сохраним, чтобы GC не съел (если нужно)\n      field.$wrapper.data(\"__bot_help_theme_mo\", mo);\n    } catch {}\n  }\n});",
  "view": "Form"
 }
]